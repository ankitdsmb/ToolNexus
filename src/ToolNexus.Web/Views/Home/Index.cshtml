@model HomeViewModel
@{
    var baseUrl = $"{Context.Request.Scheme}://{Context.Request.Host}";

    ViewData["Title"] = "ToolNexus | Fast & Free Online Developer Tools";
    ViewData["Description"] = "ToolNexus provides high-performance browser-based developer tools including formatters, converters, validators and encoders. No login. No clutter.";
    ViewData["CanonicalUrl"] = $"{baseUrl}/";
    ViewData["Keywords"] = "online developer tools, json formatter, xml validator, base64 encoder, css minifier, free coding tools";

    ViewData["JsonLd"] = System.Text.Json.JsonSerializer.Serialize(new
    {
        @context = "https://schema.org",
        @type = "WebSite",
        name = "ToolNexus",
        url = $"{baseUrl}/",
        description = "Fast and minimal online developer tools.",
        potentialAction = new
        {
            @type = "SearchAction",
            target = $"{baseUrl}/tools?search={{search_term_string}}",
            query_input = "required name=search_term_string"
        }
    });
}

<section class="hero" aria-labelledby="heroHeading">
    <div class="hero__glow" aria-hidden="true"></div>
    <div class="hero__container">
        <p class="hero__eyebrow">Built for speed and trust</p>
        <h1 id="heroHeading" class="hero__title">
            Professional developer tools, instantly in your browser.
        </h1>

        <p class="hero__subtitle">
            Format, validate, convert, and optimize data in seconds with a lightweight interface engineered for performance.
        </p>

        <form class="hero__search" role="search" aria-label="Find tools">
            <label for="toolSearch" class="u-sr-only">Search featured developer tools</label>
            <input id="toolSearch"
                   class="search"
                   placeholder="Try: JSON formatter, XML validator, Base64 encoder"
                   autocomplete="off"
                   spellcheck="false" />
        </form>
    </div>
</section>

<section class="tool-section" aria-labelledby="featuredToolsHeading">
    <header class="tool-section__header">
        <h2 id="featuredToolsHeading" class="section-title">Featured Tools</h2>
        <p class="section-subtitle">Start with our most-used utilities for everyday engineering workflows.</p>
    </header>

    <div class="grid" id="featuredGrid">
        @foreach (var tool in Model.FeaturedTools)
        {
            <a class="card" href="/tools/@tool.Slug" data-title="@tool.Title" data-description="@tool.SeoDescription">
                <div class="card__content">
                    <h3>@tool.Title</h3>
                    <p>@tool.SeoDescription</p>
                </div>
                <span class="card__arrow" aria-hidden="true">â†’</span>
            </a>
        }
    </div>
</section>

@section Scripts {
<script>
    (function () {
        const searchBox = document.getElementById('toolSearch');
        const cards = Array.from(document.querySelectorAll('#featuredGrid .card'));

        if (!searchBox || cards.length === 0) return;

        const normalizedCards = cards.map((card) => {
            const titleNode = card.querySelector('h3');
            const descriptionNode = card.querySelector('p');
            const title = card.dataset.title || titleNode?.textContent || '';
            const description = card.dataset.description || descriptionNode?.textContent || '';

            return { card, titleNode, descriptionNode, title, description, searchable: `${title} ${description}`.toLowerCase() };
        });

        const escapeRegExp = (value) => value.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

        const highlightText = (node, originalText, query) => {
            if (!node) return;
            if (!query) {
                node.textContent = originalText;
                return;
            }

            const pattern = new RegExp(`(${escapeRegExp(query)})`, 'ig');
            node.innerHTML = originalText.replace(pattern, '<mark>$1</mark>');
        };

        const debounce = (fn, delay) => {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => fn(...args), delay);
            };
        };

        const applySearch = (rawQuery) => {
            const query = rawQuery.toLowerCase().trim();

            requestAnimationFrame(() => {
                normalizedCards.forEach((entry) => {
                    const matches = !query || entry.searchable.includes(query);
                    entry.card.classList.toggle('is-hidden', !matches);
                    entry.card.setAttribute('aria-hidden', matches ? 'false' : 'true');

                    highlightText(entry.titleNode, entry.title, query);
                    highlightText(entry.descriptionNode, entry.description, query);
                });
            });
        };

        const debouncedSearch = debounce(applySearch, 250);

        searchBox.addEventListener('input', (event) => {
            debouncedSearch(event.target.value || '');
        });
    })();
</script>
}
