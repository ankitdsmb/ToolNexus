@model HomeViewModel
@{
    var baseUrl = $"{Context.Request.Scheme}://{Context.Request.Host}";

    ViewData["Title"] = "ToolNexus | Fast & Free Online Developer Tools";
    ViewData["Description"] = "ToolNexus provides high-performance browser-based developer tools including formatters, converters, validators and encoders. No login. No clutter.";
    ViewData["CanonicalUrl"] = $"{baseUrl}/";
    ViewData["Keywords"] = "online developer tools, json formatter, xml validator, base64 encoder, css minifier, free coding tools";

    ViewData["JsonLd"] = System.Text.Json.JsonSerializer.Serialize(new
    {
        @context = "https://schema.org",
        @type = "WebSite",
        name = "ToolNexus",
        url = $"{baseUrl}/",
        description = "Fast and minimal online developer tools.",
        potentialAction = new
        {
            @type = "SearchAction",
            target = $"{baseUrl}/tools?search={{search_term_string}}",
            query_input = "required name=search_term_string"
        }
    });
}

<partial name="_Hero" />

<section class="tool-section" data-reveal id="featuredTools" aria-labelledby="featuredToolsHeading">
    <header class="tool-section__header">
        <h2 id="featuredToolsHeading" class="section-title">Featured Tools</h2>
        <p class="section-subtitle">Start with our most-used utilities for everyday engineering workflows.</p>
        <div class="tool-discovery" aria-label="Tool discovery controls">
            <form class="hero__search" role="search" aria-label="Filter featured tools">
                <label for="toolSearch" class="u-sr-only">Search featured developer tools</label>
                <div class="discovery-search-shell">
                    <span class="discovery-search-shell__icon" aria-hidden="true">⌘K</span>
                    <input id="toolSearch"
                           class="search search--discovery"
                           placeholder="Search tools..."
                           autocomplete="off"
                           spellcheck="false" />
                </div>
            </form>

            <div class="tool-discovery__row" aria-label="Quick utilities">
                <span class="tool-discovery__label">Quick utilities</span>
                <div class="tool-discovery__chips">
                    <a class="tool-discovery__chip" href="/tools/uuid-generator" data-utility="uuid">UUID</a>
                    <a class="tool-discovery__chip" href="/tools/base64-encode" data-utility="base64">Base64</a>
                    <a class="tool-discovery__chip" href="/tools/json-formatter" data-utility="json">JSON</a>
                </div>
            </div>

            <div class="tool-discovery__row" aria-label="Trending tools" id="trendingRow">
                <span class="tool-discovery__label">Trending</span>
                <div class="tool-discovery__chips" id="trendingTools"></div>
            </div>

            <div class="tool-discovery__row" aria-label="Recently used tools" id="recentRow">
                <span class="tool-discovery__label">Recently used</span>
                <div class="tool-discovery__chips" id="recentTools"></div>
            </div>
        </div>
    </header>

    <div class="grid" id="featuredGrid">
        @foreach (var tool in Model.FeaturedTools.Select((tool, index) => new { tool, index }))
        {
            var title = tool.tool.Title;
            var slug = tool.tool.Slug;
            var description = string.IsNullOrWhiteSpace(tool.tool.SeoDescription)
                ? "Instant utility workflows with zero context switching."
                : tool.tool.SeoDescription;
            if (description.Length > 92)
            {
                description = $"{description[..89]}...";
            }
            var normalized = $"{title} {slug}".ToLowerInvariant();
            var badge = tool.index switch
            {
                0 => "Popular",
                1 => "Fast",
                _ when normalized.Contains("json") || normalized.Contains("formatter") => "Developer Favorite",
                _ => "New"
            };

            <a class="card" href="/tools/@slug" data-tool-slug="@slug" data-title="@title" data-description="@description">
                <header class="card__header">
                    <span class="card__icon" aria-hidden="true">@title.Substring(0, Math.Min(title.Length, 2)).ToUpperInvariant()</span>
                    <div class="card__title-wrap">
                        <div class="card__title-row">
                            <h3>@title</h3>
                            <span class="card__badge" data-badge="@badge">@badge</span>
                        </div>
                        <p>@description</p>
                    </div>
                    <span class="card__arrow" aria-hidden="true">↗</span>
                </header>

                <ul class="card__highlights" aria-label="Tool highlights">
                    <li>Client-side execution by default</li>
                    <li>Low-latency transform pipeline</li>
                    <li>Built for daily engineering workflows</li>
                </ul>

                <span class="card__cta">Launch Tool</span>
            </a>
        }
    </div>
</section>

<section class="trust-section" data-reveal id="trust" aria-labelledby="trustHeading">
    <header class="trust-section__header">
        <p class="trust-section__eyebrow">Built for developers who value reliability</p>
        <h2 id="trustHeading" class="section-title">Trust &amp; platform credibility</h2>
        <p class="section-subtitle">ToolNexus prioritizes speed, transparency, and privacy with production-grade quality standards.</p>
    </header>

    <div class="trust-stats" role="list" aria-label="ToolNexus live platform stats">
        <article class="trust-stat" role="listitem" data-reveal>
            <span class="trust-stat__icon" aria-hidden="true">◉</span>
            <p class="trust-stat__label">Tools used today</p>
            <p class="trust-stat__value"><span data-counter data-dynamic-stat="toolsToday" data-target="28491">0</span><span class="trust-stat__suffix">+</span></p>
            <p class="trust-stat__meta">Active sessions across formatting, conversion, and validation workflows.</p>
        </article>
        <article class="trust-stat" role="listitem" data-reveal>
            <span class="trust-stat__icon" aria-hidden="true">⚡</span>
            <p class="trust-stat__label">Avg response time</p>
            <p class="trust-stat__value"><span data-counter data-dynamic-stat="loadTime" data-target="42">0</span><span class="trust-stat__suffix">ms</span></p>
            <p class="trust-stat__meta">Client-side execution tuned for instant developer feedback loops.</p>
        </article>
        <article class="trust-stat" role="listitem" data-reveal>
            <span class="trust-stat__icon" aria-hidden="true">◈</span>
            <p class="trust-stat__label">Uptime</p>
            <p class="trust-stat__value"><span data-counter data-dynamic-stat="perf" data-target="99.99" data-decimals="2">0</span><span class="trust-stat__suffix">%</span></p>
            <p class="trust-stat__meta">Monitored infrastructure with availability-first deployment practices.</p>
        </article>
        <article class="trust-stat" role="listitem" data-reveal>
            <span class="trust-stat__icon" aria-hidden="true">⌁</span>
            <p class="trust-stat__label">Files processed</p>
            <p class="trust-stat__value"><span data-counter data-dynamic-stat="sessions" data-target="1245703">0</span><span class="trust-stat__suffix">+</span></p>
            <p class="trust-stat__meta">Processed securely in-browser without sending source payloads to storage.</p>
        </article>
    </div>

    <div class="trust-grid">
        <article class="privacy-card" aria-labelledby="privacyHeading">
            <h3 id="privacyHeading">Privacy commitment</h3>
            <ul class="privacy-card__list">
                <li><strong>100% client-side processing</strong> for core tool operations.</li>
                <li><strong>No server storage</strong> of file content, snippets, or transformation output.</li>
                <li><strong>Session-first architecture</strong> designed for security-conscious engineering teams.</li>
            </ul>
        </article>

        <aside class="trust-links" aria-label="Product trust resources">
            <a class="trust-link" href="https://github.com" target="_blank" rel="noopener noreferrer">GitHub ↗</a>
            <a class="trust-link" href="/roadmap">Roadmap</a>
            <a class="trust-link" href="/changelog">Changelog</a>
        </aside>
    </div>

    <div class="testimonial-grid" aria-label="Developer testimonials">
        <article class="testimonial-card" data-reveal>
            <span class="testimonial-card__badge" aria-hidden="true">PR</span>
            <p class="testimonial-card__quote">“ToolNexus replaced half of our ad-hoc scripts. Fast enough to stay in flow, polished enough to trust in demos.”</p>
            <p class="testimonial-card__meta"><strong>Priya R.</strong><span>Staff Engineer, Fintech platform</span></p>
        </article>
        <article class="testimonial-card" data-reveal>
            <span class="testimonial-card__badge" aria-hidden="true">JM</span>
            <p class="testimonial-card__quote">“The command-palette UX and keyboard shortcuts feel native to modern dev tooling. It’s now part of our daily toolkit.”</p>
            <p class="testimonial-card__meta"><strong>Jordan M.</strong><span>Developer Experience Lead</span></p>
        </article>
        <article class="testimonial-card" data-reveal>
            <span class="testimonial-card__badge" aria-hidden="true">AK</span>
            <p class="testimonial-card__quote">“Privacy guarantees mattered for our enterprise clients. In-browser processing made the security review straightforward.”</p>
            <p class="testimonial-card__meta"><strong>Ava K.</strong><span>Principal Solutions Architect</span></p>
        </article>
    </div>
</section>

@section Scripts {
<script>
    (function () {
        const searchBox = document.getElementById('toolSearch');
        const cards = Array.from(document.querySelectorAll('#featuredGrid .card'));
        const trendingToolsContainer = document.getElementById('trendingTools');
        const recentToolsContainer = document.getElementById('recentTools');
        const recentRow = document.getElementById('recentRow');
        const typewriterText = document.getElementById('heroTypewriter');
        const counterNodes = Array.from(document.querySelectorAll('[data-counter]'));
        const RECENT_TOOLS_KEY = 'toolnexus.recent.tools';

        if (typewriterText) {
            const tools = ['JSON Formatter', 'Regex Tester', 'Base64 Encoder', 'SQL Formatter', 'Text Diff'];
            let toolIndex = 0;
            let charIndex = 0;
            let direction = 1;

            const tick = () => {
                const current = tools[toolIndex];
                charIndex += direction;

                typewriterText.textContent = current.slice(0, charIndex);

                if (charIndex === current.length) {
                    direction = -1;
                    setTimeout(tick, 1300);
                    return;
                }

                if (charIndex === 0) {
                    direction = 1;
                    toolIndex = (toolIndex + 1) % tools.length;
                    setTimeout(tick, 280);
                    return;
                }

                setTimeout(tick, direction > 0 ? 85 : 45);
            };

            tick();
        }

        if (counterNodes.length) {
            const animateCounter = (node) => {
                const targetValue = Number(node.dataset.target || 0);
                const decimals = Number(node.dataset.decimals || 0);
                if (!Number.isFinite(targetValue)) return;

                const duration = 1400;
                const startTime = performance.now();

                const render = (timestamp) => {
                    const elapsed = Math.min((timestamp - startTime) / duration, 1);
                    const eased = 1 - Math.pow(1 - elapsed, 3);
                    const value = targetValue * eased;
                    node.textContent = value.toLocaleString(undefined, {
                        minimumFractionDigits: decimals,
                        maximumFractionDigits: decimals
                    });

                    if (elapsed < 1) {
                        requestAnimationFrame(render);
                    }
                };

                requestAnimationFrame(render);
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (!entry.isIntersecting) return;
                    animateCounter(entry.target);
                    observer.unobserve(entry.target);
                });
            }, { threshold: 0.35 });

            counterNodes.forEach((node) => observer.observe(node));
        }

        if (!searchBox || cards.length === 0) return;

        const normalizedCards = cards.map((card) => {
            const titleNode = card.querySelector('h3');
            const descriptionNode = card.querySelector('p');
            const title = card.dataset.title || titleNode?.textContent || '';
            const description = card.dataset.description || descriptionNode?.textContent || '';

            return { card, titleNode, descriptionNode, title, description, searchable: `${title} ${description}`.toLowerCase() };
        });

        const escapeRegExp = (value) => value.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

        const highlightText = (node, originalText, query) => {
            if (!node) return;
            if (!query) {
                node.textContent = originalText;
                return;
            }

            const pattern = new RegExp(`(${escapeRegExp(query)})`, 'ig');
            node.innerHTML = originalText.replace(pattern, '<mark>$1</mark>');
        };

        const debounce = (fn, delay) => {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => fn(...args), delay);
            };
        };

        const applySearch = (rawQuery) => {
            const query = rawQuery.toLowerCase().trim();

            requestAnimationFrame(() => {
                normalizedCards.forEach((entry) => {
                    const matches = !query || entry.searchable.includes(query);
                    entry.card.classList.toggle('is-hidden', !matches);
                    entry.card.setAttribute('aria-hidden', matches ? 'false' : 'true');

                    highlightText(entry.titleNode, entry.title, query);
                    highlightText(entry.descriptionNode, entry.description, query);
                });
            });
        };

        const debouncedSearch = debounce(applySearch, 250);

        searchBox.addEventListener('input', (event) => {
            debouncedSearch(event.target.value || '');
        });

        const topTools = cards
            .slice(0, 5)
            .map((card) => ({
                title: card.dataset.title || card.querySelector('h3')?.textContent || 'Tool',
                slug: card.dataset.toolSlug || ''
            }))
            .filter((tool) => tool.slug);

        const readRecentTools = () => {
            try {
                const parsed = JSON.parse(localStorage.getItem(RECENT_TOOLS_KEY) || '[]');
                return Array.isArray(parsed) ? parsed : [];
            } catch {
                return [];
            }
        };

        const writeRecentTools = (tools) => {
            localStorage.setItem(RECENT_TOOLS_KEY, JSON.stringify(tools.slice(0, 5)));
        };

        const renderDiscoveryChips = (container, tools, emptyLabel) => {
            if (!container) return;
            if (!tools.length) {
                container.innerHTML = `<span class="tool-discovery__empty">${emptyLabel}</span>`;
                return;
            }

            container.innerHTML = tools
                .map((tool) => `<a class="tool-discovery__chip" href="/tools/${tool.slug}">${tool.title}</a>`)
                .join('');
        };

        renderDiscoveryChips(trendingToolsContainer, topTools, 'Ranking in progress');

        const recentTools = readRecentTools();
        renderDiscoveryChips(recentToolsContainer, recentTools, 'No tools launched yet — your recently used tools will appear here.');
        if (recentRow) {
            recentRow.classList.toggle('is-empty', recentTools.length === 0);
        }

        cards.forEach((card) => {
            card.addEventListener('click', () => {
                const slug = card.dataset.toolSlug;
                if (!slug) return;
                const title = card.dataset.title || card.querySelector('h3')?.textContent || 'Tool';

                const nextTools = [{ slug, title }, ...readRecentTools().filter((tool) => tool.slug !== slug)];
                writeRecentTools(nextTools);
            });
        });
    })();
</script>
}
