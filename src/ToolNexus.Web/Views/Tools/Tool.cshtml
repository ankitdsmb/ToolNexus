@model ToolPageViewModel
@{
    ViewData["Title"] = Model.Seo.Title;
    ViewData["Description"] = Model.Seo.Description;
    ViewData["CanonicalUrl"] = Model.Seo.CanonicalUrl;
    ViewData["JsonLd"] = Model.Seo.JsonLd;
    ViewData["Keywords"] = Model.Seo.Keywords;
}

<article class="tool-page" data-slug="@Model.Tool.Slug" data-client-safe-actions="@string.Join(",", Model.Tool.ClientSafeActions)">
  <header class="tool-page__heading">
    <div>
      <h1>@Model.Tool.Title</h1>
      <p>@Model.Tool.SeoDescription</p>
    </div>

    <div class="tool-page__action-selector">
      <label for="actionSelect">Action</label>
      <select id="actionSelect">
        @foreach (var action in Model.Tool.Actions)
        {
          <option value="@action">@action</option>
        }
      </select>
    </div>
  </header>

  <div class="tool-page__actions" role="toolbar" aria-label="Tool actions">
    <button id="runBtn" class="tool-btn tool-btn--primary" type="button" aria-busy="false">
      <span class="spinner" aria-hidden="true"></span>
      <span class="tool-btn__label" data-loading-label="Runningâ€¦" data-default-label="Run">Run</span>
    </button>
    <button id="copyBtn" class="tool-btn" type="button">Copy Output</button>
    <button id="downloadBtn" class="tool-btn" type="button">Download Output</button>
    <button id="shareBtn" class="tool-btn" type="button">Share Link</button>
    <button id="shortcutBtn" class="tool-btn" type="button" aria-haspopup="dialog">Shortcuts</button>
    <p class="shortcut-hint" id="shortcutHint">Shortcut: Ctrl + Enter</p>
  </div>

  <div id="errorMessage" class="tool-error" role="alert" aria-live="assertive" hidden></div>

  <section class="tool-page__grid">
    <section class="tool-panel" aria-labelledby="toolInputHeading">
      <div class="panel-header">
        <h2 id="toolInputHeading">Input</h2>
      </div>

      <div class="sample-panel">
        <h3>Sample Data</h3>
        <pre id="sampleInput">@Model.Tool.ExampleInput</pre>
      </div>

      <div class="editor-field">
        <label for="inputEditor" class="editor-label">Tool input</label>
        <textarea id="inputEditor" aria-describedby="shortcutHint">@Model.Tool.ExampleInput</textarea>
        <div id="inputEditorSurface" class="editor-surface" aria-hidden="true"></div>
      </div>
    </section>

    <section class="tool-panel" aria-labelledby="toolOutputHeading">
      <div class="panel-header">
        <h2 id="toolOutputHeading">Output</h2>
        <p id="resultStatus" class="result-indicator result-indicator--idle" role="status" aria-live="polite">Ready</p>
      </div>

      <div id="outputEmptyState" class="tool-empty-state" role="status" aria-live="polite">
        <strong>No output yet.</strong>
        <span>Run the tool to render results in this panel.</span>
      </div>

      <div class="editor-field" id="outputField" hidden>
        <label for="outputEditor" class="editor-label">Tool output</label>
        <textarea id="outputEditor" readonly></textarea>
        <div id="outputEditorSurface" class="editor-surface" aria-hidden="true"></div>
      </div>
    </section>
  </section>

  <section class="tool-panel tool-ux" aria-labelledby="toolUxHeading">
    <div class="panel-header">
      <h2 id="toolUxHeading">Developer UX Layer</h2>
      <span class="tool-ux__tag">Persistent</span>
    </div>

    <div class="tool-ux__grid">
      <section>
        <h3>Pinned + Recent</h3>
        <ul id="uxPinnedRecent" class="ux-list"></ul>
      </section>
      <section>
        <h3>Run History</h3>
        <ul id="uxHistory" class="ux-list"></ul>
      </section>
      <section>
        <h3>Collections</h3>
        <div class="ux-collection-controls">
          <input id="collectionNameInput" type="text" placeholder="Collection name" maxlength="32" />
          <button id="saveCollectionBtn" class="tool-btn" type="button">Save Tool</button>
        </div>
        <ul id="uxCollections" class="ux-list"></ul>
      </section>
    </div>
  </section>

  <section id="toastRegion" class="toast-region" aria-live="polite" aria-atomic="true" aria-relevant="additions text"></section>

  <dialog id="shortcutDialog" class="shortcut-dialog" aria-labelledby="shortcutTitle">
    <form method="dialog" class="shortcut-dialog__content">
      <header class="shortcut-dialog__header">
        <h2 id="shortcutTitle">Keyboard shortcuts</h2>
        <button class="tool-btn" value="cancel">Close</button>
      </header>
      <ul class="shortcut-list">
        <li><kbd>Ctrl/Cmd + Enter</kbd><span>Run current tool</span></li>
        <li><kbd>Ctrl/Cmd + K</kbd><span>Open command palette</span></li>
        <li><kbd>Ctrl/Cmd + Shift + S</kbd><span>Create shareable link</span></li>
        <li><kbd>?</kbd><span>Toggle this shortcut sheet</span></li>
      </ul>
    </form>
  </dialog>

@if (Model.Content is not null)
{
  <section class="tool-panel">
    <h2>How It Works</h2>
    <p>@Model.Content.LongArticle</p>

    @if (Model.Content.Features.Any())
    {
      <h3>Features</h3>
      <ul>
      @foreach (var feature in Model.Content.Features)
      {
        <li>@feature</li>
      }
      </ul>
    }

    @if (Model.Content.Faqs.Any())
    {
      <h3>FAQ</h3>
      @foreach (var faq in Model.Content.Faqs)
      {
        <details>
          <summary>@faq.Question</summary>
          <p>@faq.Answer</p>
        </details>
      }
    }

    @if (Model.Content.RelatedTools.Any())
    {
      <h3>Related Tools</h3>
      <ul>
      @foreach (var related in Model.Content.RelatedTools)
      {
        <li><a href="/tools/@related.RelatedSlug">@related.RelatedSlug</a></li>
      }
      </ul>
    }
  </section>
}

</article>

@section Scripts {
  <script>
    window.ToolNexusConfig = {
      apiBaseUrl: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ApiBaseUrl)),
      toolExecutionPathPrefix: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ToolExecutionPathPrefix))
    };
  </script>
  <script type="module" src="~/js/tool-page.js" asp-append-version="true"></script>
  <script type="module" src="~/js/tools/@(Model.Tool.Slug).js" asp-append-version="true"></script>
}
