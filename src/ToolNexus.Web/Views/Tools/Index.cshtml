@using System.Globalization
@model ToolIndexViewModel
@{
    var canonicalUrl = $"{Context.Request.Scheme}://{Context.Request.Host}/tools";
    ViewData["Title"] = "All Developer Tools | ToolNexus";
    ViewData["Description"] = "Browse all ToolNexus developer utilities by category, including converters, validators, and formatters.";
    ViewData["CanonicalUrl"] = canonicalUrl;
    ViewData["Keywords"] = "developer tools list, online utilities, tool categories";
    ViewData["JsonLd"] = System.Text.Json.JsonSerializer.Serialize(new
    {
        @context = "https://schema.org",
        @type = "CollectionPage",
        name = "All ToolNexus Tools",
        url = canonicalUrl,
        description = "Browse all tools available on ToolNexus."
    });

    var groupedTools = Model.Tools
        .GroupBy(tool => string.IsNullOrWhiteSpace(tool.Category) ? "Utility" : tool.Category)
        .OrderBy(group => group.Key)
        .ToList();

    var cardIndex = 0;
}

<article class="tools-index page-shell" data-reveal aria-label="Tool catalog">
    <header class="u-stack">
        <h1>All Tools</h1>
        <p class="u-muted">Choose a utility by category or jump directly into a tool.</p>
        <p class="u-muted">If you are unsure where to start, scan by task: format data first, validate it second, and convert only after the structure is stable.</p>
    </header>

    <section class="tools-index__toolbar" aria-label="Tool filters">
        <div class="tools-index__toolbar-top">
            <label class="u-sr-only" for="toolsSearchInput">Search tools</label>
            <input id="toolsSearchInput"
                   class="search"
                   type="search"
                   placeholder="Search by tool name, tag, or category"
                   autocomplete="off"
                   spellcheck="false" />

            <div class="view-toggle" role="group" aria-label="Grid density">
                <button type="button" class="view-toggle__btn is-active" data-density="comfortable">Comfortable</button>
                <button type="button" class="view-toggle__btn" data-density="compact">Compact</button>
            </div>
        </div>

        <div class="tools-index__categories" aria-label="Filter by category">
            <button type="button" class="chip is-active" data-category-filter="all">All</button>
            @foreach (var group in groupedTools)
            {
                <button type="button" class="chip" data-category-filter="@group.Key">@CultureInfo.CurrentCulture.TextInfo.ToTitleCase(group.Key)</button>
            }
        </div>
    </section>

    @foreach (var group in groupedTools)
    {
        var title = CultureInfo.CurrentCulture.TextInfo.ToTitleCase(group.Key);

        <section class="tool-group" data-tool-group data-category="@group.Key">
            <header class="tool-group__header">
                <h2 class="tool-group__title">@title</h2>
                <span class="tool-group__count" data-group-count>@group.Count() tools</span>
            </header>
            <p class="u-muted">Use @title tools when you need repeatable, low-friction workflows for @group.Key transformations and checks.</p>

            <div class="tool-grid is-loading" id="toolGrid-@group.Key.Replace(" ", "-").ToLowerInvariant()" aria-live="polite">
                @foreach (var tool in group)
                {
                    @await Html.PartialAsync("_ToolCard", tool, new ViewDataDictionary(ViewData) { ["CardIndex"] = cardIndex++ })
                }
            </div>
        </section>
    }
    <section class="static-page__section" aria-labelledby="chooseToolHeading">
        <h2 id="chooseToolHeading">How to choose the right tool</h2>
        <ol>
            <li>Start with formatters when input is hard to read.</li>
            <li>Run validators before converting or sharing output.</li>
            <li>Use encoders and decoders only when transport protocols require them.</li>
            <li>Compare old and new output with Text Diff before merge.</li>
        </ol>
    </section>

    <section class="static-page__section" aria-labelledby="workflowDiscoveryHeading">
        <h2 id="workflowDiscoveryHeading">Workflow-based discovery</h2>
        <p>For API debugging, start with <a href="/tools/json-formatter">JSON Formatter</a>, then <a href="/tools/json-validator">JSON Validator</a>, then <a href="/tools/text-diff">Text Diff</a>.</p>
        <p>For data interchange tasks, pair <a href="/tools/json-to-csv">JSON to CSV</a> with <a href="/tools/csv-to-json">CSV to JSON</a> so teams can move between systems without hand-editing raw values.</p>
    </section>

    <section class="static-page__section" aria-labelledby="relatedCategoriesHeading">
        <h2 id="relatedCategoriesHeading">Related categories</h2>
        <ul class="static-page__link-list">
            @foreach (var category in Model.Categories.OrderBy(c => c))
            {
                <li><a href="/tools/@Uri.EscapeDataString(category)">@CultureInfo.CurrentCulture.TextInfo.ToTitleCase(category)</a></li>
            }
        </ul>
    </section>
</article>
