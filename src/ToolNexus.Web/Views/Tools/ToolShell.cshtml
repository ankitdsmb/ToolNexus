@model ToolPageViewModel
@{
    ViewData["Title"] = Model.Seo.Title;
    ViewData["Description"] = Model.Seo.Description;
    ViewData["CanonicalUrl"] = Model.Seo.CanonicalUrl;
    ViewData["JsonLd"] = Model.Seo.JsonLd;
    ViewData["Keywords"] = Model.Seo.Keywords;
}

@section Head {
    @if (!string.IsNullOrWhiteSpace(Model.RuntimeCssPath))
    {
        <link rel="stylesheet" href="@Model.RuntimeCssPath" asp-append-version="true" />
    }
}

<article class="tool-shell-page tool-page page-shell" aria-label="Tool runtime page">
    <header class="tool-shell-page__hero tool-panel" aria-label="Tool introduction">
        <p class="tool-section__eyebrow">Runtime workspace</p>
        <div class="tool-shell-page__hero-main">
            <h1>@Model.Tool.Title</h1>
            <p>@(Model.Content?.Intro ?? Model.Tool.SeoDescription)</p>
        </div>
        <div class="tool-shell-page__hero-meta" aria-label="Tool metadata">
            <span class="chip">@Model.Tool.Category</span>
            <span class="chip">@Model.Tool.Actions.Count action@(Model.Tool.Actions.Count == 1 ? string.Empty : "s")</span>
            <span class="chip">@(Model.Tool.IsDeterministic ? "Deterministic" : "Adaptive")</span>
        </div>
    </header>

    <section class="tool-shell-page__layout" aria-label="Interactive tool and documentation">
        <div id="tool-root" class="tool-shell-page__runtime" data-tool-root="true" data-tool-slug="@Model.Tool.Slug" aria-label="Interactive runtime"></div>

        <article class="tool-seo tool-shell-page__docs" data-nosnippet="false" aria-label="Tool documentation">
            <section class="tool-seo__description" aria-label="Long description">
                <h2>Overview</h2>
                <p>@(Model.Content?.LongDescription ?? Model.Tool.SeoDescription)</p>
            </section>

            @if (Model.Content?.Features.Any() == true)
            {
                <section class="tool-seo__features" aria-label="Key features">
                    <h2>Features</h2>
                    <ul>
                        @foreach (var feature in Model.Content.Features)
                        {
                            <li>@feature</li>
                        }
                    </ul>
                </section>
            }

            @if (Model.Content?.Steps.Any() == true)
            {
                <section class="tool-seo__usage" aria-label="How to use">
                    <h2>How to use</h2>
                    <ol>
                        @foreach (var step in Model.Content.Steps)
                        {
                            <li>
                                <h3>@step.Title</h3>
                                <p>@step.Description</p>
                            </li>
                        }
                    </ol>
                </section>
            }

            @if (Model.Content?.Examples.Any() == true)
            {
                <section class="tool-seo__examples" aria-label="Examples">
                    <h2>Examples</h2>
                    @foreach (var example in Model.Content.Examples)
                    {
                        <article>
                            <h3>@example.Title</h3>
                            <p><strong>Input:</strong> @example.Input</p>
                            <p><strong>Output:</strong> @example.Output</p>
                        </article>
                    }
                </section>
            }

            @if (Model.Content?.Faq.Any() == true)
            {
                <section class="tool-seo__faq" aria-label="Frequently asked questions">
                    <h2>FAQ</h2>
                    @foreach (var faq in Model.Content.Faq)
                    {
                        <article>
                            <h3>@faq.Question</h3>
                            <p>@faq.Answer</p>
                        </article>
                    }
                </section>
            }

            @if (Model.Content?.UseCases.Any() == true)
            {
                <section class="tool-seo__use-cases" aria-label="Use cases">
                    <h2>Use cases</h2>
                    <ul>
                        @foreach (var useCase in Model.Content.UseCases)
                        {
                            <li>@useCase</li>
                        }
                    </ul>
                </section>
            }

            @if (Model.RelatedTools.Any())
            {
                <section class="tool-seo__related" aria-label="Related tools">
                    <h2>Related tools</h2>
                    <ul>
                        @foreach (var relatedTool in Model.RelatedTools)
                        {
                            <li><a href="/tools/@relatedTool.Slug">@relatedTool.Title</a></li>
                        }
                    </ul>
                </section>
            }

            @if (Model.SameCategoryTools.Any())
            {
                <section class="tool-seo__related" aria-label="Same category tools">
                    <h2>Same category tools</h2>
                    <ul>
                        @foreach (var relatedTool in Model.SameCategoryTools)
                        {
                            <li><a href="/tools/@relatedTool.Slug">@relatedTool.Title</a></li>
                        }
                    </ul>
                </section>
            }

            @if (Model.NextTools.Any())
            {
                <section class="tool-seo__related" aria-label="Next tools">
                    <h2>Next tools</h2>
                    <ul>
                        @foreach (var relatedTool in Model.NextTools)
                        {
                            <li><a href="/tools/@relatedTool.Slug">@relatedTool.Title</a></li>
                        }
                    </ul>
                </section>
            }
            <section class="tool-seo__guide" aria-label="Expanded guide">
                <h2>Practical workflow guide</h2>
                <p>Use @Model.Tool.Title when you need a fast, deterministic step in a broader engineering workflow. The typical pattern is to run a small sample first, verify the output, then process the full input.</p>
                <h3>When this tool is most useful</h3>
                <ul>
                    <li>Code review prep where formatting or conversion clarity matters.</li>
                    <li>Incident triage where logs or payloads need normalization.</li>
                    <li>Cross-team handoff where consistent output reduces ambiguity.</li>
                </ul>
                <h3>Troubleshooting checklist</h3>
                <ul>
                    <li>Confirm the input format matches the expected action.</li>
                    <li>Test with a minimal sample before pasting large payloads.</li>
                    <li>If output looks wrong, compare source and result using Text Diff.</li>
                </ul>
                <h3>Common mistakes</h3>
                <ul>
                    <li>Running conversion before validating source data.</li>
                    <li>Assuming output is production-ready without downstream checks.</li>
                    <li>Pasting encoded values without decoding the transport layer first.</li>
                </ul>
            </section>

            <section class="tool-seo__examples" aria-label="Additional practical examples">
                <h2>Additional practical examples</h2>
                <article>
                    <h3>Example workflow: review-ready output</h3>
                    <p><strong>Input:</strong> Raw payload copied from logs.</p>
                    <p><strong>Action:</strong> Format and validate before sharing in a ticket or pull request.</p>
                    <p><strong>Outcome:</strong> Teammates can reproduce and debug without manual cleanup.</p>
                </article>
                <article>
                    <h3>Example workflow: conversion with validation</h3>
                    <p><strong>Input:</strong> Structured data from an upstream service.</p>
                    <p><strong>Action:</strong> Validate structure first, then convert to target format for downstream systems.</p>
                    <p><strong>Outcome:</strong> Fewer runtime errors caused by malformed intermediate data.</p>
                </article>
            </section>

            <section class="tool-seo__related" aria-label="Related workflows">
                <h2>Related workflows</h2>
                <ul>
                    <li><a href="/tools">Browse all tools by category</a></li>
                    <li><a href="/tools/json-formatter">Format payloads before validation</a></li>
                    <li><a href="/tools/json-validator">Validate structured data before conversion</a></li>
                    <li><a href="/tools/text-diff">Compare before and after outputs</a></li>
                </ul>
            </section>
        </article>
    </section>
</article>

@section Scripts {
    <script>
        window.ToolNexusConfig = {
            apiBaseUrl: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ApiBaseUrl)),
            toolExecutionPathPrefix: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ToolExecutionPathPrefix)),
            runtimeModulePath: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.RuntimeModulePath)),
            tool: {
                slug: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tool.Slug)),
                title: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tool.Title)),
                seoDescription: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tool.SeoDescription)),
                exampleInput: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tool.ExampleInput)),
                clientSafeActions: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tool.ClientSafeActions))
            }
        };
    </script>
    <script type="module" src="~/js/tool-runtime.js" asp-append-version="true"></script>
}
