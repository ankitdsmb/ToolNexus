@model ToolPageViewModel
@{
    ViewData["Title"] = Model.Seo.Title;
    ViewData["Description"] = Model.Seo.Description;
    ViewData["CanonicalUrl"] = Model.Seo.CanonicalUrl;
    ViewData["JsonLd"] = Model.Seo.JsonLd;
    ViewData["Keywords"] = Model.Seo.Keywords;
}

@section Head {
    @if (!string.IsNullOrWhiteSpace(Model.RuntimeCssPath))
    {
        <link rel="stylesheet" href="@Model.RuntimeCssPath" asp-append-version="true" />
    }
}

<article class="tool-shell-page tool-page page-shell" aria-label="Tool runtime page">
    <header class="tool-shell-page__hero tool-panel" aria-label="Tool introduction">
        <p class="tool-section__eyebrow">Runtime workspace</p>
        <div class="tool-shell-page__hero-main">
            <h1>@Model.Tool.Title</h1>
            <p>@(Model.Content?.Intro ?? Model.Tool.SeoDescription)</p>
        </div>
        <div class="tool-shell-page__hero-meta" aria-label="Tool metadata">
            <span class="chip">@Model.Tool.Category</span>
            <span class="chip">@Model.Tool.Actions.Count action@(Model.Tool.Actions.Count == 1 ? string.Empty : "s")</span>
            <span class="chip">@(Model.Tool.IsDeterministic ? "Deterministic" : "Adaptive")</span>
        </div>
    </header>

    <section aria-label="Runtime workspace">
        <div id="tool-root" class="tool-shell-page__runtime" data-tool-root="true" data-tool-slug="@Model.Tool.Slug" aria-label="Interactive runtime"></div>
    </section>

    <article class="tool-seo tool-shell-page__docs" data-nosnippet="false" aria-label="Tool documentation">
        <section class="readme-block readme-intro-block" aria-label="Overview">
            <p class="tool-section__eyebrow">ReadmeIntroBlock</p>
            <h2>Overview</h2>
            <p>@(Model.Content?.LongDescription ?? Model.Tool.SeoDescription)</p>
        </section>


        @if (Model.Content?.Features.Any() == true)
        {
            <section class="readme-block" aria-label="Key features">
                <h2>Features</h2>
                <ul>
                    @foreach (var feature in Model.Content.Features)
                    {
                        <li>@feature</li>
                    }
                </ul>
            </section>
        }

        @if (Model.Content?.Steps.Any() == true)
        {
            <section class="readme-block quick-start-panel" aria-label="Quick start">
                <p class="tool-section__eyebrow">QuickStartPanel</p>
                <h2>Quick start</h2>
                <ol>
                    @foreach (var step in Model.Content.Steps)
                    {
                        <li>
                            <h3>@step.Title</h3>
                            <p>@step.Description</p>
                        </li>
                    }
                </ol>
                <aside class="tip-highlight-box" aria-label="Troubleshooting tip">
                    <h3>TipHighlightBox</h3>
                    <p>Run one small sample first. Confirm the output, then scale to full payloads.</p>
                </aside>
            </section>
        }

        @if (Model.Content?.Examples.Any() == true)
        {
            <section class="readme-block" aria-label="Examples">
                <p class="tool-section__eyebrow">ExampleCardGrid</p>
                <h2>Examples</h2>
                <div class="readme-card-grid readme-card-grid--examples">
                    @foreach (var example in Model.Content.Examples)
                    {
                        <article class="readme-card">
                            <h3>@example.Title</h3>
                            <p><strong>Input:</strong> @example.Input</p>
                            <p><strong>Output:</strong> @example.Output</p>
                        </article>
                    }
                </div>
            </section>
        }

        @if (Model.Content?.UseCases.Any() == true)
        {
            <section class="readme-block" aria-label="Use cases">
                <p class="tool-section__eyebrow">UseCaseWorkflowGrid</p>
                <h2>Use cases</h2>
                <div class="readme-card-grid readme-card-grid--use-cases">
                    @foreach (var useCase in Model.Content.UseCases)
                    {
                        <article class="readme-card readme-card--workflow">
                            <h3>Workflow</h3>
                            <p>@useCase</p>
                        </article>
                    }
                </div>
            </section>
        }

        @if (Model.Content?.Faq.Any() == true)
        {
            <section class="readme-block" aria-label="Frequently asked questions">
                <p class="tool-section__eyebrow">FAQAccordion</p>
                <h2>FAQ</h2>
                <div class="faq-accordion" itemscope itemtype="https://schema.org/FAQPage">
                    @foreach (var faq in Model.Content.Faq)
                    {
                        <details class="faq-accordion__item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                            <summary itemprop="name">@faq.Question</summary>
                            <p itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer"><span itemprop="text">@faq.Answer</span></p>
                        </details>
                    }
                </div>
            </section>
        }

        @if (Model.RelatedTools.Any() || Model.SameCategoryTools.Any() || Model.NextTools.Any())
        {
            <section class="readme-block" aria-label="Related tools">
                <p class="tool-section__eyebrow">RelatedToolsGrid</p>
                <h2>Related tools</h2>
                <div class="readme-card-grid readme-card-grid--related">
                    @foreach (var relatedTool in Model.RelatedTools.Concat(Model.SameCategoryTools).Concat(Model.NextTools).GroupBy(t => t.Slug).Select(g => g.First()))
                    {
                        <article class="readme-card">
                            <h3>@relatedTool.Title</h3>
                            <p>Continue your workflow with a companion tool.</p>
                            <a href="/tools/@relatedTool.Slug">Open tool</a>
                        </article>
                    }
                </div>
            </section>
        }
    </article>
</article>

@section Scripts {
    <script>
        window.ToolNexusConfig = {
            apiBaseUrl: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ApiBaseUrl)),
            toolExecutionPathPrefix: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ToolExecutionPathPrefix)),
            runtimeModulePath: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.RuntimeModulePath)),
            tool: {
                slug: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tool.Slug)),
                title: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tool.Title)),
                seoDescription: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tool.SeoDescription)),
                exampleInput: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tool.ExampleInput)),
                clientSafeActions: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Tool.ClientSafeActions))
            }
        };
    </script>
    <script type="module" src="~/js/tool-runtime.js" asp-append-version="true"></script>
}
