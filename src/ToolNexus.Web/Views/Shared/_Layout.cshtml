@using ToolNexus.Application.Services
@using System.Text.Json
@using System.Reflection
@inject IToolCatalogService ToolCatalogService
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
@{
    var title = ViewData["Title"]?.ToString() ?? "ToolNexus";
    var description = ViewData["Description"]?.ToString() ?? "ToolNexus online developer tools.";
    var canonicalUrl = ViewData["CanonicalUrl"]?.ToString()
        ?? $"{Context.Request.Scheme}://{Context.Request.Host}{Context.Request.Path}{Context.Request.QueryString}";
    var keywords = ViewData["Keywords"]?.ToString() ?? "developer tools, online utilities, ToolNexus";
    var robots = ViewData["Robots"]?.ToString() ?? "index,follow";
    var jsonLd = ViewData["JsonLd"]?.ToString();
    var siteUrl = $"{Context.Request.Scheme}://{Context.Request.Host}";
    var socialImageUrl = ViewData["SocialImageUrl"]?.ToString() ?? $"{siteUrl}/assets/toolnexus-og.svg";
    var defaultJsonLd = JsonSerializer.Serialize(new
    {
        @context = "https://schema.org",
        @graph = new object[]
        {
            new
            {
                @type = "Organization",
                name = "ToolNexus",
                url = siteUrl,
                logo = $"{siteUrl}/assets/toolnexus-og.svg"
            },
            new
            {
                @type = "WebSite",
                name = "ToolNexus",
                url = siteUrl,
                description = "Developer-first utility platform for faster shipping."
            }
        }
    });
}

@{
    var assembly = Assembly.GetEntryAssembly() ?? Assembly.GetExecutingAssembly();
    var version = assembly.GetName().Version;
    var versionDisplay = version is null ? "v0.0.0" : $"v{version.Major}.{version.Minor}.{Math.Max(version.Build, 0)}";
    var buildNumber = Environment.GetEnvironmentVariable("TOOLNEXUS_BUILD_NUMBER") ?? "local";
}

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>@title</title>

    <script>
        (function () {
            var key = 'toolnexus-theme';
            var stored = localStorage.getItem(key);
            var preferred = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            var theme = stored === 'light' || stored === 'dark' ? stored : preferred;
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>

    <meta name="description" content="@description" />
    <meta name="keywords" content="@keywords" />
    <meta name="robots" content="@robots" />
    <meta name="theme-color" content="#0b1020" />
    <link rel="canonical" href="@canonicalUrl" />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com" />
    <link rel="preload" href="~/css/site.css" as="style" asp-append-version="true" />
    <link rel="modulepreload" href="~/js/command-palette.js" asp-append-version="true" />

    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="ToolNexus" />
    <meta property="og:title" content="@title" />
    <meta property="og:description" content="@description" />
    <meta property="og:url" content="@canonicalUrl" />
    <meta property="og:image" content="@socialImageUrl" />
    <meta property="og:image:alt" content="ToolNexus developer utility platform" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:image" content="@socialImageUrl" />
    <meta name="twitter:title" content="@title" />
    <meta name="twitter:description" content="@description" />

    @if (!string.IsNullOrWhiteSpace(jsonLd))
    {
        <script type="application/ld+json">
            @Html.Raw(jsonLd)
        </script>
    }

    <script type="application/ld+json">
        @Html.Raw(defaultJsonLd)
    </script>

    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @await RenderSectionAsync("Head", required: false)
</head>

<body class="page-enter">
<div class="app-shell">
    <header class="topbar">
        <div class="topbar__inner">
            <a href="/" class="brand" aria-label="ToolNexus Home">
                <span class="brand__dot" aria-hidden="true"></span>
                <span>ToolNexus</span>
            </a>

            <div class="topbar__search-wrap">
                <label class="u-sr-only" for="globalToolSearch">Search tools</label>
                <input id="globalToolSearch"
                       class="topbar__search"
                       placeholder="Search tools..."
                       autocomplete="off" />
            </div>

            <nav class="topbar__nav" aria-label="Primary Navigation">
                <a class="topbar__link" href="/">Home</a>
                <a class="topbar__link" href="/tools">Tools</a>
                <a class="topbar__link" href="/about">About</a>
                <a class="topbar__link" href="/disclaimer">Disclaimer</a>
                <a class="topbar__link" href="/contact-us">Contact Us</a>
            </nav>

            <button id="themeToggle"
                    class="theme-toggle"
                    type="button"
                    aria-label="Activate dark theme"
                    aria-pressed="false">
                <span class="theme-toggle__icon" aria-hidden="true">◐</span>
                <span class="theme-toggle__text">Theme</span>
            </button>
        </div>
    </header>

    <div class="banner">
        Do not paste secrets or sensitive credentials.
    </div>

    <main class="container">
        @RenderBody()
    </main>

    <footer class="footer">
        <div class="footer__divider" aria-hidden="true"></div>
        <div class="footer__inner">
            <div class="footer__meta">
                <a href="/" class="footer__brand" aria-label="ToolNexus Home">
                    <span class="brand__dot" aria-hidden="true"></span>
                    <span>ToolNexus</span>
                </a>
                <p class="footer__tagline">Developer-first utility platform for faster shipping.</p>
                <p class="footer__version">@versionDisplay · Build @buildNumber</p>
            </div>

            <nav class="footer__links" aria-label="Footer Navigation">
                <section class="footer__column" aria-label="Product links">
                    <p class="footer__title">Product</p>
                    <a href="/tools">Tools</a>
                    <a href="/about">About</a>
                    <a href="/contact-us">Contact</a>
                </section>

                <section class="footer__column" aria-label="Tools links">
                    <p class="footer__title">Tools</p>
                    <a href="/tools/json-formatter">JSON Formatter</a>
                    <a href="/tools/json-validator">JSON Validator</a>
                    <a href="/tools/regex-tester">Regex Tester</a>
                </section>

                <section class="footer__column" aria-label="Resources links">
                    <p class="footer__title">Resources</p>
                    <a href="https://github.com" target="_blank" rel="noopener noreferrer">GitHub</a>
                    <a href="#" aria-disabled="true">Roadmap</a>
                    <a href="#" aria-disabled="true">Changelog</a>
                    <a href="#" aria-disabled="true">API (coming soon)</a>
                </section>

                <section class="footer__column" aria-label="Company links">
                    <p class="footer__title">Company</p>
                    <a href="/disclaimer">Disclaimer</a>
                    <a href="#" aria-disabled="true">Privacy</a>
                    <a href="#" aria-disabled="true">Terms</a>
                </section>
            </nav>

            <div class="footer__bottom">
                <span>© @DateTime.UtcNow.Year ToolNexus. All rights reserved.</span>
                <div class="footer__social" aria-label="Social links">
                    <a href="https://github.com" target="_blank" rel="noopener noreferrer" aria-label="ToolNexus on GitHub">
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M12 2C6.48 2 2 6.59 2 12.24c0 4.52 2.87 8.35 6.84 9.71.5.1.68-.22.68-.49 0-.24-.01-.88-.01-1.72-2.78.62-3.37-1.37-3.37-1.37-.45-1.19-1.11-1.5-1.11-1.5-.91-.63.07-.62.07-.62 1 .07 1.53 1.06 1.53 1.06.9 1.56 2.36 1.11 2.94.85.09-.67.35-1.11.63-1.37-2.22-.26-4.56-1.14-4.56-5.08 0-1.12.39-2.03 1.03-2.74-.1-.26-.45-1.31.1-2.74 0 0 .84-.27 2.75 1.05A9.4 9.4 0 0 1 12 7.09c.85 0 1.71.12 2.51.36 1.91-1.32 2.75-1.05 2.75-1.05.55 1.43.2 2.48.1 2.74.64.71 1.03 1.62 1.03 2.74 0 3.95-2.35 4.81-4.58 5.07.36.31.68.92.68 1.86 0 1.34-.01 2.42-.01 2.75 0 .27.18.6.69.49A10.25 10.25 0 0 0 22 12.24C22 6.59 17.52 2 12 2Z"></path>
                        </svg>
                    </a>
                    <a href="https://x.com" target="_blank" rel="noopener noreferrer" aria-label="ToolNexus on X">
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M18.9 2H22l-6.77 7.73L23 22h-6.1l-4.78-6.31L6.6 22H3.5l7.24-8.27L1 2h6.25l4.32 5.76L18.9 2Zm-1.07 18.2h1.69L6.34 3.7H4.53L17.83 20.2Z"></path>
                        </svg>
                    </a>
                    <a href="https://www.linkedin.com" target="_blank" rel="noopener noreferrer" aria-label="ToolNexus on LinkedIn">
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M6.94 8.75v12.06H2.93V8.75h4.01Zm.26-3.73C7.2 6.2 6.29 7.1 4.94 7.1S2.68 6.2 2.68 5.02C2.68 3.82 3.6 2.94 4.97 2.94c1.36 0 2.22.88 2.23 2.08ZM21.32 13.9v6.91H17.3v-6.44c0-1.62-.58-2.72-2.02-2.72-1.1 0-1.76.74-2.05 1.46-.1.26-.13.61-.13.97v6.73h-4.01s.05-10.92 0-12.06h4.01v1.71c.53-.82 1.48-1.98 3.62-1.98 2.64 0 4.6 1.72 4.6 5.42Z"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </footer>

</div>

@{
    var commandPaletteTools = ToolCatalogService.GetAllTools()
        .Select(tool => new
        {
            slug = tool.Slug,
            title = tool.Title,
            category = tool.Category,
            description = tool.SeoDescription
        });
}

<script id="toolCatalogData" type="application/json">@Html.Raw(JsonSerializer.Serialize(commandPaletteTools))</script>

<div id="commandPalette" class="command-palette" hidden>
    <button class="command-palette__overlay" type="button" data-command-close tabindex="-1" aria-label="Close command palette"></button>

    <section class="command-palette__dialog" role="dialog" aria-modal="true" aria-labelledby="commandPaletteTitle">
        <header class="command-palette__header">
            <p id="commandPaletteTitle" class="command-palette__title">Command Palette</p>
            <p class="command-palette__shortcut">Esc to close</p>
        </header>

        <label class="u-sr-only" for="commandPaletteInput">Search tools and commands</label>
        <input id="commandPaletteInput" class="command-palette__input" type="text" autocomplete="off" placeholder="Search tools, actions, recents..." />

        <p class="command-palette__assistive" id="commandPaletteHint">Use arrow keys to navigate and Enter to run a command.</p>
        <ul id="commandPaletteList" class="command-palette__list" role="listbox" aria-describedby="commandPaletteHint"></ul>
    </section>
</div>

<script>
    (function () {
        var key = 'toolnexus-theme';
        var root = document.documentElement;
        var toggle = document.getElementById('themeToggle');
        if (!toggle) return;

        function getTheme() {
            return root.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
        }

        function syncToggle(theme) {
            var dark = theme === 'dark';
            toggle.setAttribute('aria-pressed', dark ? 'true' : 'false');
            toggle.setAttribute('aria-label', dark ? 'Activate light theme' : 'Activate dark theme');
        }

        syncToggle(getTheme());

        toggle.addEventListener('click', function () {
            var next = getTheme() === 'dark' ? 'light' : 'dark';
            root.setAttribute('data-theme', next);
            localStorage.setItem(key, next);
            syncToggle(next);
            window.dispatchEvent(new CustomEvent('toolnexus:themechange', { detail: { theme: next } }));
        });

        var media = window.matchMedia('(prefers-color-scheme: dark)');
        media.addEventListener('change', function (event) {
            if (localStorage.getItem(key)) return;
            var next = event.matches ? 'dark' : 'light';
            root.setAttribute('data-theme', next);
            syncToggle(next);
            window.dispatchEvent(new CustomEvent('toolnexus:themechange', { detail: { theme: next } }));
        });
    })();
</script>


<script>
    (function () {
        document.addEventListener('click', function (event) {
            var anchor = event.target.closest('a[href]');
            if (!anchor) return;
            if (anchor.target && anchor.target !== '_self') return;
            if (anchor.hasAttribute('download')) return;
            var href = anchor.getAttribute('href');
            if (!href || href.startsWith('#') || href.startsWith('mailto:') || href.startsWith('tel:')) return;
            if (anchor.origin !== window.location.origin) return;
            document.body.classList.add('page-transitioning');
        });

        window.addEventListener('pageshow', function () {
            document.body.classList.remove('page-transitioning');
        });
    })();
</script>

<script type="module" src="~/js/command-palette.js" asp-append-version="true"></script>
<script type="module" src="~/js/motion-system.js" asp-append-version="true"></script>

@await RenderSectionAsync("Scripts", required: false)

</body>
</html>
