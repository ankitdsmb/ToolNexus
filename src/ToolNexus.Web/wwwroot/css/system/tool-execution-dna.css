/* =====================================================================
   TOOL EXECUTION DNA SYSTEM
   Ownership model:
   - Shell framing tokens (consumed by shell CSS only)
   - Tool widget internals (scoped to tool content host/runtime widget)
   ===================================================================== */

:root {
  /* compact execution spacing scale */
  --tn-exec-space-0: 2px;
  --tn-exec-space-1: 4px;
  --tn-exec-space-2: 8px;
  --tn-exec-space-3: 12px;
  --tn-exec-space-4: 16px;
  --tn-exec-space-5: 20px;

  /* runtime panel tokens */
  --tn-runtime-panel-gap: var(--tn-exec-space-2);
  --tn-runtime-panel-padding: 14px;
  --tn-runtime-panel-border: 1px solid color-mix(in srgb, var(--border-default) 82%, transparent);
  --tn-runtime-panel-surface: color-mix(in srgb, var(--bg-secondary) 96%, var(--bg-primary));
  --tn-runtime-panel-shadow: 0 8px 18px rgba(15, 23, 42, 0.06);

  /* header sizing */
  --tn-exec-header-min-height: 34px;
  --tn-exec-header-title-size: var(--text-sm);

  /* toolbar density */
  --tn-exec-toolbar-min-height: 34px;
  --tn-exec-toolbar-gap: var(--tn-exec-space-2);

  /* editor region spacing */
  --tn-exec-editor-gap: 14px;
  --tn-exec-editor-padding: var(--tn-exec-space-2);
  --tn-exec-editor-min-height: clamp(380px, 46vh, 460px);
  --tn-exec-motion-fast: 150ms;

  /* metrics row styling */
  --tn-exec-metrics-gap: var(--tn-exec-space-2);
  --tn-exec-metrics-font-size: var(--text-xs);
  --tn-exec-metrics-pill-padding: 4px var(--tn-exec-space-2);

  /* unified border + radius system */
  --tn-exec-border: 1px solid color-mix(in srgb, var(--border-default) 86%, transparent);
  --tn-exec-border-strong: 1px solid color-mix(in srgb, var(--accent) 28%, var(--border-default));
  --tn-exec-radius-xs: 6px;
  --tn-exec-radius-sm: 8px;
  --tn-exec-radius-md: 10px;
  --tn-exec-radius-lg: 12px;
}

/* Tool-internal execution widget baseline */
:where([data-tool-content-host="true"] .tool-runtime-widget) {
  margin: 0;
  padding: 0 var(--tn-exec-space-0) var(--tn-exec-space-1);
  display: grid;
  gap: 11px;
  align-content: start;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-header) {
  min-height: var(--tn-exec-header-min-height);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: var(--tn-exec-space-1) var(--tn-exec-space-2);
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions) {
  min-height: var(--tn-exec-toolbar-min-height);
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--tn-exec-toolbar-gap);
  padding: 3px 0 2px;
  margin-top: 1px;
  margin-bottom: 2px;
  border-top: 1px solid color-mix(in srgb, var(--border-default) 58%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn)) {
  position: relative;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):is(:nth-child(3), :nth-child(4))) {
  margin-left: var(--tn-exec-space-2);
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):nth-child(3))::before {
  content: '';
  position: absolute;
  left: calc(var(--tn-exec-space-2) * -1 - 1px);
  top: 6px;
  bottom: 6px;
  width: 1px;
  background: color-mix(in srgb, var(--border-default) 78%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-body) {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(clamp(240px, 34vw, 420px), 1fr));
  gap: var(--tn-exec-editor-gap);
  align-items: stretch;
  min-height: var(--tn-exec-editor-min-height);
  padding-top: 2px;
}

/* Auto-layout ownership contract: panel-count aware, forced at runtime anchor level. */
:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body:has(> :only-child)) {
  grid-template-columns: minmax(0, 1fr) !important;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body:has(> :nth-child(2):last-child)) {
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) !important;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body:has(> :nth-child(3))) {
  grid-template-columns: repeat(auto-fit, minmax(clamp(220px, 30vw, 360px), 1fr)) !important;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body > *) {
  min-width: 0;
  min-height: calc(var(--tn-exec-editor-min-height) - 24px);
  height: 100%;
  align-self: stretch;
  overflow: hidden;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-editor-panel) {
  min-height: calc(var(--tn-exec-editor-min-height) - 24px);
  display: grid;
  grid-template-rows: auto minmax(0, 1fr);
  gap: var(--tn-exec-space-1);
  align-content: stretch;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :first-child) {
  min-height: 30px;
  display: flex;
  align-items: baseline;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :last-child) {
  min-height: 0;
  overflow: auto;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :last-child) {
  background: color-mix(in srgb, var(--bg-elevated) 72%, #000 28%);
  border: var(--tn-exec-border);
  border-radius: var(--tn-exec-radius-sm);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.02), inset 0 0 0 1px rgba(15, 23, 42, 0.1), 0 1px 2px rgba(15, 23, 42, 0.16);
  transition: border-color var(--tn-exec-motion-fast) var(--ease-standard), box-shadow var(--tn-exec-motion-fast) var(--ease-standard);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface):focus-within > :last-child) {
  border-color: color-mix(in srgb, var(--accent) 54%, var(--border-default));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.02), 0 0 0 2px color-mix(in srgb, var(--accent) 26%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])) {
  scrollbar-width: thin;
  scrollbar-color: color-mix(in srgb, var(--text-muted) 40%, transparent) transparent;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])::-webkit-scrollbar) {
  width: 9px;
  height: 9px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])::-webkit-scrollbar-thumb) {
  border-radius: var(--radius-pill);
  background: color-mix(in srgb, var(--text-muted) 38%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])::-webkit-scrollbar-track) {
  background: transparent;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-metrics),
:where(.runtime-metrics-row) {
  margin: 0;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--tn-exec-metrics-gap);
  font-size: var(--tn-exec-metrics-font-size);
  line-height: 1.15;
  padding: var(--tn-exec-metrics-pill-padding);
  border: var(--tn-exec-border);
  border-radius: var(--tn-exec-radius-sm);
  background: color-mix(in srgb, var(--bg-secondary) 74%, var(--bg-primary));
  min-height: 30px;
  opacity: 0.86;
}

/* Tool personality modifiers (micro-delta only, no layout ownership changes). */
:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-editor) {
  --tn-exec-editor-gap: 16px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-editor .tool-local-header) {
  letter-spacing: 0.01em;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-converter) {
  --tn-exec-editor-gap: 12px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-converter .tool-local-actions) {
  padding-top: 2px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-analyzer) {
  --tn-exec-editor-gap: 14px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-analyzer .tool-local-header) {
  font-weight: 600;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-utility) {
  --tn-exec-editor-gap: 11px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-utility .tool-local-actions) {
  opacity: 0.95;
}

/* Universal execution button variants */
:where(.tool-btn--primary, .tn-exec-btn--primary) {
  border: var(--tn-exec-border-strong);
  border-radius: var(--tn-exec-radius-sm);
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 88%, white 12%), var(--accent));
  color: #fff;
  font-weight: 700;
}

:where(.tool-btn--secondary, .tn-exec-btn--secondary) {
  border: var(--tn-exec-border);
  border-radius: var(--tn-exec-radius-sm);
  background: color-mix(in srgb, var(--bg-elevated) 92%, var(--bg-primary));
  color: var(--text-primary);
  font-weight: 600;
}

:where(.tool-btn--ghost, .tn-exec-btn--ghost) {
  border: 1px solid transparent;
  border-radius: var(--tn-exec-radius-sm);
  background: transparent;
  color: var(--text-secondary);
}

:where(.tool-btn--primary, .tn-exec-btn--primary, .tool-btn--secondary, .tn-exec-btn--secondary, .tool-btn--ghost, .tn-exec-btn--ghost) {
  transition: transform 150ms var(--ease-standard), box-shadow 160ms var(--ease-standard), border-color 160ms var(--ease-standard), opacity 150ms var(--ease-standard), filter 140ms var(--ease-standard);
}

:where(.tool-btn--primary, .tn-exec-btn--primary):hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 10px 20px color-mix(in srgb, var(--accent) 26%, transparent);
}

:where(.tool-btn--primary, .tn-exec-btn--primary):active:not(:disabled) {
  transform: translateY(0) scale(0.98);
}

:where(.tool-btn--primary, .tn-exec-btn--primary, .tool-btn--secondary, .tn-exec-btn--secondary, .tool-btn--ghost, .tn-exec-btn--ghost):focus-visible {
  outline: 2px solid color-mix(in srgb, var(--accent) 85%, white 15%);
  outline-offset: 2px;
}

/* Toolbar hierarchy normalization when tools omit explicit button variants. */
:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):first-child:not(.tool-btn--secondary):not(.tool-btn--ghost)) {
  border: var(--tn-exec-border-strong);
  border-radius: var(--tn-exec-radius-sm);
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 88%, white 12%), var(--accent));
  color: #fff;
  font-weight: 700;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):is(:nth-child(2), :nth-child(3)):not(.tool-btn--primary):not(.tool-btn--ghost)) {
  border: var(--tn-exec-border);
  border-radius: var(--tn-exec-radius-sm);
  background: color-mix(in srgb, var(--bg-elevated) 92%, var(--bg-primary));
  color: var(--text-primary);
  font-weight: 600;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):nth-child(n + 4):not(.tool-btn--primary):not(.tool-btn--secondary)) {
  border: 1px solid transparent;
  border-radius: var(--tn-exec-radius-sm);
  background: transparent;
  color: var(--text-secondary);
}

@media (max-width: 920px) {
  :where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-body) {
    grid-template-columns: minmax(0, 1fr);
    min-height: 0;
  }

  :where([data-tool-content-host="true"] .tool-runtime-widget .tool-editor-panel) {
    min-height: 220px;
  }
}
