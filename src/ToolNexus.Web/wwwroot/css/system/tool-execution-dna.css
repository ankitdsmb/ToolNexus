/* =====================================================================
   TOOL EXECUTION DNA SYSTEM
   Ownership model:
   - Shell framing tokens (consumed by shell CSS only)
   - Tool widget internals (scoped to tool content host/runtime widget)
   ===================================================================== */

:root {
  /* compact execution spacing scale */
  --tn-exec-space-0: 2px;
  --tn-exec-space-1: 4px;
  --tn-exec-space-2: 8px;
  --tn-exec-space-3: 11px;
  --tn-exec-space-4: 16px;
  --tn-exec-space-5: 20px;

  /* runtime panel tokens */
  --tn-runtime-panel-gap: 0;
  --tn-runtime-panel-padding: 2px;
  --tn-runtime-panel-border: 1px solid color-mix(in srgb, var(--border-default) 74%, transparent);
  --tn-runtime-panel-surface: color-mix(in srgb, var(--bg-secondary) 97%, var(--bg-primary));
  --tn-runtime-panel-shadow: none;
  --tn-exec-workspace-surface: color-mix(in srgb, var(--bg-secondary) 97%, var(--bg-primary));
  --tn-exec-workspace-border: 1px solid color-mix(in srgb, var(--accent) 15%, var(--border-default));
  --tn-exec-workspace-divider: color-mix(in srgb, var(--border-default) 58%, transparent);
  --tn-exec-structural-separator: color-mix(in srgb, var(--border-default) 40%, transparent);
  --tn-exec-lower-panel-min-height: 72px;
  --tn-exec-empty-min-height: 34px;
  --tn-exec-empty-max-height: 56px;

  /* header sizing */
  --tn-exec-header-min-height: 28px;
  --tn-exec-header-title-size: var(--text-sm);

  /* toolbar density */
  --tn-exec-toolbar-min-height: 26px;
  --tn-exec-toolbar-max-height: 30px;
  --tn-exec-toolbar-gap: 3px;

  /* editor region spacing */
  --tn-exec-editor-gap: 1px;
  --tn-exec-editor-padding: var(--tn-exec-space-2);
  --tn-exec-editor-min-height: clamp(400px, 71vh, 760px);
  --tn-exec-motion-fast: 150ms;

  /* metrics row styling */
  --tn-exec-metrics-gap: 13px;
  --tn-exec-metrics-font-size: var(--text-xs);
  --tn-exec-metrics-pill-padding: 3px 11px;

  /* unified border + radius system */
  --tn-exec-border: 1px solid color-mix(in srgb, var(--border-default) 86%, transparent);
  --tn-exec-border-strong: 1px solid color-mix(in srgb, var(--accent) 28%, var(--border-default));
  --tn-exec-radius-xs: 6px;
  --tn-exec-radius-sm: 8px;
  --tn-exec-radius-md: 10px;
  --tn-exec-radius-lg: 12px;

  /* Level 3 execution authority aliases (consumes global design DNA tokens when available). */
  --tn-workspace-dominance: var(--workspace-dominance, 1);
  --tn-execution-surface-anchor: var(--execution-surface-anchor, 1);
  --tn-control-recession: var(--control-recession, 1);
  --tn-shell-passive-mode: var(--shell-passive-mode, 1);
}

/* Tool-internal execution widget baseline */
:where([data-tool-content-host="true"] .tool-runtime-widget) {
  margin: 0;
  padding: 2px 4px;
  display: grid;
  gap: 1px;
  align-content: start;
  border: var(--tn-exec-workspace-border);
  border-radius: calc(var(--tn-exec-radius-sm) + 1px);
  background:
    linear-gradient(180deg, color-mix(in srgb, var(--accent) calc(6% + (var(--tn-workspace-dominance) * 2%)), transparent) 0%, transparent 58%),
    var(--tn-exec-workspace-surface);
  box-shadow: none;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-header) {
  min-height: var(--tn-exec-header-min-height);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 6px 11px;
  padding: 0 2px;
  border-bottom: 1px solid color-mix(in srgb, var(--border-default) 36%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-header :is(h2, h3, .tool-title, .tool-local-title)) {
  font-weight: 675;
  letter-spacing: 0.005em;
  color: color-mix(in srgb, var(--text-primary) 96%, var(--text-secondary));
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions) {
  min-height: var(--tn-exec-toolbar-min-height);
  max-height: var(--tn-exec-toolbar-max-height);
  display: flex;
  align-items: center;
  flex-wrap: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  gap: var(--tn-exec-toolbar-gap);
  padding: 0 1px;
  margin-top: 0;
  margin-bottom: 0;
  border-top: 0;
  border-bottom: 1px solid color-mix(in srgb, var(--border-default) 42%, transparent);
  background: color-mix(in srgb, var(--tn-exec-workspace-surface) 100%, transparent);
  scrollbar-width: thin;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions > *) {
  flex: 0 0 auto;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions > :not(:first-child)) {
  position: relative;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions > :not(:first-child))::before {
  content: '';
  width: 1px;
  height: 15px;
  margin-right: 3px;
  background: color-mix(in srgb, var(--border-default) 46%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions :is(button, .tool-btn, [role="button"], a.tool-btn)) {
  min-height: 25px;
  white-space: nowrap;
  border-color: color-mix(in srgb, var(--border-default) 52%, transparent);
  background: color-mix(in srgb, var(--tn-exec-workspace-surface) 96%, var(--bg-primary));
  box-shadow: none;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-body) {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(clamp(240px, 34vw, 420px), 1fr));
  gap: var(--tn-exec-editor-gap);
  align-items: stretch;
  min-height: var(--tn-exec-editor-min-height);
  padding-top: 0;
  margin-top: 0;
  background: color-mix(in srgb, var(--tn-exec-workspace-divider) 74%, transparent);
  border-top: 1px solid color-mix(in srgb, var(--tn-exec-structural-separator) 56%, transparent);
  border-bottom: 1px solid color-mix(in srgb, var(--tn-exec-structural-separator) 48%, transparent);
  border-radius: calc(var(--tn-exec-radius-sm) - 1px);
  overflow: hidden;
}

/* Auto-layout ownership contract: panel-count aware, forced at runtime anchor level. */
:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body:has(> :only-child)) {
  grid-template-columns: minmax(0, 1fr) !important;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body:has(> :nth-child(2):last-child)) {
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) !important;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body:has(> :nth-child(3))) {
  grid-template-columns: repeat(auto-fit, minmax(clamp(220px, 30vw, 360px), 1fr)) !important;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body > *) {
  min-width: 0;
  min-height: calc(var(--tn-exec-editor-min-height) - 2px);
  height: 100%;
  align-self: stretch;
  overflow: hidden;
  border: 0;
  border-radius: 0;
  background: color-mix(in srgb, var(--tn-exec-workspace-surface) 96%, var(--bg-primary));
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-editor-panel) {
  min-height: calc(var(--tn-exec-editor-min-height) - 2px);
  display: grid;
  grid-template-rows: auto minmax(0, 1fr);
  gap: 1px;
  align-content: stretch;
  padding: 1px 3px 1px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :first-child) {
  min-height: 25px;
  display: flex;
  align-items: baseline;
  font-weight: 620;
  color: color-mix(in srgb, var(--text-primary) 98%, var(--text-secondary));
  margin-bottom: 0;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :last-child) {
  min-height: 0;
  overflow: auto;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :last-child:empty) {
  min-height: var(--tn-exec-empty-min-height);
  max-height: var(--tn-exec-empty-max-height);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :last-child:is([data-empty="true"], .is-empty, [aria-busy="false"]:empty)) {
  min-height: var(--tn-exec-empty-min-height);
  max-height: var(--tn-exec-empty-max-height);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface):has(> :last-child:is(:empty, [data-empty="true"], .is-empty, [aria-busy="false"]:empty))) {
  grid-template-rows: auto auto;
  align-content: start;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-editor-panel:has(> :last-child:is(:empty, [data-empty="true"], .is-empty, [aria-busy="false"]:empty))) {
  min-height: var(--tn-exec-lower-panel-min-height);
  max-height: calc(var(--tn-exec-empty-max-height) + 28px);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :last-child) {
  background: color-mix(in srgb, var(--tn-exec-workspace-surface) calc(96% + (var(--tn-workspace-dominance) * 2%)), var(--bg-primary));
  border: 1px solid color-mix(in srgb, var(--border-default) calc(58% + (var(--tn-workspace-dominance) * 3%)), transparent);
  border-radius: calc(var(--tn-exec-radius-sm) - 1px);
  box-shadow: none;
  transition: border-color var(--tn-exec-motion-fast) var(--ease-standard), box-shadow var(--tn-exec-motion-fast) var(--ease-standard);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface):not(:first-child)) {
  border-top: 1px solid color-mix(in srgb, var(--tn-exec-structural-separator) 42%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface):focus-within > :last-child) {
  border-color: color-mix(in srgb, var(--accent) 44%, var(--border-default));
  box-shadow: 0 0 0 1px color-mix(in srgb, var(--accent) 20%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])) {
  scrollbar-width: thin;
  scrollbar-color: color-mix(in srgb, var(--text-muted) 40%, transparent) transparent;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])::-webkit-scrollbar) {
  width: 9px;
  height: 9px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])::-webkit-scrollbar-thumb) {
  border-radius: var(--radius-pill);
  background: color-mix(in srgb, var(--text-muted) 38%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])::-webkit-scrollbar-track) {
  background: transparent;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-metrics),
:where(.runtime-metrics-row) {
  margin: 0;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--tn-exec-metrics-gap);
  font-size: var(--tn-exec-metrics-font-size);
  line-height: 1.1;
  padding: 0 2px;
  border: 0;
  border-top: 1px solid color-mix(in srgb, var(--border-default) 15%, transparent);
  border-bottom: 1px solid color-mix(in srgb, var(--tn-exec-structural-separator) 22%, transparent);
  border-radius: 0;
  background: color-mix(in srgb, var(--bg-secondary) calc(38% - (var(--tn-shell-passive-mode) * 6%)), var(--bg-primary));
  min-height: 15px;
  max-height: 18px;
  opacity: 0.52;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions :is(label.tool-toggle, .tool-toggle)) {
  min-height: 25px;
  padding: 0 5px;
  border: 1px solid color-mix(in srgb, var(--border-default) 42%, transparent);
  border-radius: var(--radius-pill);
  background: color-mix(in srgb, var(--tn-exec-workspace-surface) 94%, var(--bg-primary));
  color: var(--text-secondary);
  font-size: var(--text-xs);
  font-weight: 580;
  line-height: 1;
  white-space: nowrap;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions :is(label.tool-toggle, .tool-toggle) input[type="checkbox"]) {
  appearance: none;
  inline-size: 12px;
  block-size: 12px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--border-default) 80%, transparent);
  margin: 0 6px 0 0;
  background: color-mix(in srgb, var(--bg-secondary) 68%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions :is(label.tool-toggle, .tool-toggle) input[type="checkbox"]:checked) {
  background: var(--accent);
  border-color: color-mix(in srgb, var(--accent) 72%, white 28%);
}

:where(.tool-shell-page__docs, .tool-seo.tool-shell-page__docs) {
  width: var(--tool-shell-rail-width);
  max-width: min(100%, 88ch);
  margin-top: 0;
  padding-top: 13px;
  border-top: 1px solid color-mix(in srgb, var(--border-default) 32%, transparent);
}

:where(.tool-shell-page__docs .tool-md-section h2, .tool-shell-page__docs .tool-md-section h3) {
  margin-block: 0.34em 0.2em;
  color: color-mix(in srgb, var(--text-primary) 92%, var(--text-secondary));
}

:where(.tool-shell-page__docs .tool-md-content p) {
  max-width: 76ch;
  margin-block: 0.24em 0.55em;
  color: color-mix(in srgb, var(--text-primary) 90%, var(--text-secondary));
}

:where(.tool-shell-page__docs .tool-md-section) {
  opacity: 0.94;
}

/* Tool personality modifiers (micro-delta only, no layout ownership changes). */
:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-editor) {
  --tn-exec-editor-gap: 1px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-editor .tool-local-header) {
  letter-spacing: 0.01em;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-converter) {
  --tn-exec-editor-gap: 1px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-converter .tool-local-actions) {
  padding-top: 2px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-analyzer) {
  --tn-exec-editor-gap: 1px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-analyzer .tool-local-header) {
  font-weight: 600;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-utility) {
  --tn-exec-editor-gap: 1px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-utility .tool-local-actions) {
  opacity: 0.95;
}

/* Universal execution button variants */
:where(.tool-btn--primary, .tn-exec-btn--primary) {
  border: var(--tn-exec-border-strong);
  border-radius: calc(var(--tn-exec-radius-sm) - 1px);
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 88%, white 12%), var(--accent));
  color: #fff;
  font-weight: 700;
}

:where(.tool-btn--secondary, .tn-exec-btn--secondary) {
  border: var(--tn-exec-border);
  border-radius: calc(var(--tn-exec-radius-sm) - 1px);
  background: color-mix(in srgb, var(--bg-elevated) 92%, var(--bg-primary));
  color: var(--text-primary);
  font-weight: 600;
}

:where(.tool-btn--ghost, .tn-exec-btn--ghost) {
  border: 1px solid transparent;
  border-radius: calc(var(--tn-exec-radius-sm) - 1px);
  background: transparent;
  color: var(--text-secondary);
}

:where(.tool-btn--primary, .tn-exec-btn--primary, .tool-btn--secondary, .tn-exec-btn--secondary, .tool-btn--ghost, .tn-exec-btn--ghost) {
  transition: transform 140ms var(--ease-standard), box-shadow 180ms var(--ease-standard), border-color 160ms var(--ease-standard), opacity 160ms var(--ease-standard), filter 140ms var(--ease-standard);
}

:where(.tool-btn--primary, .tn-exec-btn--primary):hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 10px 20px color-mix(in srgb, var(--accent) 26%, transparent);
}

:where(.tool-btn--primary, .tn-exec-btn--primary):active:not(:disabled) {
  transform: translateY(0) scale(0.98);
}

:where(.tool-btn--primary, .tn-exec-btn--primary, .tool-btn--secondary, .tn-exec-btn--secondary, .tool-btn--ghost, .tn-exec-btn--ghost):focus-visible {
  outline: 2px solid color-mix(in srgb, var(--accent) 85%, white 15%);
  outline-offset: 2px;
}

/* Toolbar hierarchy normalization when tools omit explicit button variants. */
:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):first-child:not(.tool-btn--secondary):not(.tool-btn--ghost)) {
  border: var(--tn-exec-border-strong);
  border-radius: calc(var(--tn-exec-radius-sm) - 1px);
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 88%, white 12%), var(--accent));
  color: #fff;
  font-weight: 700;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):is(:nth-child(2), :nth-child(3)):not(.tool-btn--primary):not(.tool-btn--ghost)) {
  border: 1px solid color-mix(in srgb, var(--border-default) 70%, transparent);
  border-radius: calc(var(--tn-exec-radius-sm) - 1px);
  background: color-mix(in srgb, var(--bg-elevated) 84%, var(--bg-primary));
  color: var(--text-primary);
  font-weight: 600;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):nth-child(n + 4):not(.tool-btn--primary):not(.tool-btn--secondary)) {
  border: 1px solid color-mix(in srgb, var(--border-default) 42%, transparent);
  border-radius: calc(var(--tn-exec-radius-sm) - 1px);
  background: color-mix(in srgb, var(--bg-secondary) 44%, transparent);
  color: var(--text-secondary);
}

@media (max-width: 920px) {
  :where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions) {
    flex-wrap: wrap;
    max-height: none;
  }

  :where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-body) {
    grid-template-columns: minmax(0, 1fr);
    min-height: 0;
  }

  :where([data-tool-content-host="true"] .tool-runtime-widget .tool-editor-panel) {
    min-height: 220px;
  }
}
