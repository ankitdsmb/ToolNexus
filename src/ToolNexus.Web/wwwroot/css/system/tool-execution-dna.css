/* =====================================================================
   TOOL EXECUTION DNA SYSTEM
   Ownership model:
   - Shell framing tokens (consumed by shell CSS only)
   - Tool widget internals (scoped to tool content host/runtime widget)
   ===================================================================== */

:root {
  /* compact execution spacing scale */
  --tn-exec-space-0: 2px;
  --tn-exec-space-1: 4px;
  --tn-exec-space-2: 8px;
  --tn-exec-space-3: 12px;
  --tn-exec-space-4: 16px;
  --tn-exec-space-5: 20px;

  /* runtime panel tokens */
  --tn-runtime-panel-gap: 6px;
  --tn-runtime-panel-padding: 8px;
  --tn-runtime-panel-border: 1px solid color-mix(in srgb, var(--border-default) 82%, transparent);
  --tn-runtime-panel-surface: color-mix(in srgb, var(--bg-secondary) 96%, var(--bg-primary));
  --tn-runtime-panel-shadow: none;
  --tn-exec-workspace-surface: color-mix(in srgb, var(--bg-secondary) 90%, var(--bg-primary));
  --tn-exec-workspace-border: 1px solid color-mix(in srgb, var(--accent) 24%, var(--border-default));
  --tn-exec-workspace-divider: color-mix(in srgb, var(--border-default) 72%, transparent);

  /* header sizing */
  --tn-exec-header-min-height: 34px;
  --tn-exec-header-title-size: var(--text-sm);

  /* toolbar density */
  --tn-exec-toolbar-min-height: 36px;
  --tn-exec-toolbar-max-height: 42px;
  --tn-exec-toolbar-gap: 8px;

  /* editor region spacing */
  --tn-exec-editor-gap: 1px;
  --tn-exec-editor-padding: var(--tn-exec-space-2);
  --tn-exec-editor-min-height: clamp(380px, 56vh, 620px);
  --tn-exec-motion-fast: 150ms;

  /* metrics row styling */
  --tn-exec-metrics-gap: 8px;
  --tn-exec-metrics-font-size: var(--text-xs);
  --tn-exec-metrics-pill-padding: 4px 12px;

  /* unified border + radius system */
  --tn-exec-border: 1px solid color-mix(in srgb, var(--border-default) 86%, transparent);
  --tn-exec-border-strong: 1px solid color-mix(in srgb, var(--accent) 28%, var(--border-default));
  --tn-exec-radius-xs: 6px;
  --tn-exec-radius-sm: 8px;
  --tn-exec-radius-md: 10px;
  --tn-exec-radius-lg: 12px;

  /* Level 3 execution authority aliases (consumes global design DNA tokens when available). */
  --tn-workspace-dominance: var(--workspace-dominance, 1);
  --tn-execution-surface-anchor: var(--execution-surface-anchor, 1);
  --tn-control-recession: var(--control-recession, 1);
  --tn-shell-passive-mode: var(--shell-passive-mode, 1);
}

/* Tool-internal execution widget baseline */
:where([data-tool-content-host="true"] .tool-runtime-widget) {
  margin: 0;
  padding: 6px 8px 8px;
  display: grid;
  gap: 6px;
  align-content: start;
  border: var(--tn-exec-workspace-border);
  border-radius: var(--tn-exec-radius-md);
  background:
    linear-gradient(180deg, color-mix(in srgb, var(--accent) calc(6% + (var(--tn-workspace-dominance) * 3%)), transparent) 0%, transparent 58%),
    var(--tn-exec-workspace-surface);
  box-shadow: none;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-header) {
  min-height: var(--tn-exec-header-min-height);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 11px 14px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions) {
  min-height: var(--tn-exec-toolbar-min-height);
  max-height: var(--tn-exec-toolbar-max-height);
  display: flex;
  align-items: center;
  flex-wrap: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  gap: var(--tn-exec-toolbar-gap);
  padding: 3px 0;
  margin-top: 0;
  margin-bottom: 8px;
  border-top: 1px solid color-mix(in srgb, var(--border-default) 26%, transparent);
  border-bottom: 1px solid color-mix(in srgb, var(--border-default) 34%, transparent);
  background: transparent;
  scrollbar-width: thin;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions > *) {
  flex: 0 0 auto;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions > :not(:first-child)) {
  position: relative;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions > :not(:first-child))::before {
  content: '';
  width: 1px;
  height: 18px;
  margin-right: 2px;
  background: color-mix(in srgb, var(--border-default) 70%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions :is(button, .tool-btn, [role="button"], a.tool-btn)) {
  min-height: 30px;
  white-space: nowrap;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-body) {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(clamp(240px, 34vw, 420px), 1fr));
  gap: var(--tn-exec-editor-gap);
  align-items: stretch;
  min-height: var(--tn-exec-editor-min-height);
  padding-top: 0;
  margin-top: 0;
  background: var(--tn-exec-workspace-divider);
  border-radius: var(--tn-exec-radius-sm);
  overflow: hidden;
}

/* Auto-layout ownership contract: panel-count aware, forced at runtime anchor level. */
:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body:has(> :only-child)) {
  grid-template-columns: minmax(0, 1fr) !important;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body:has(> :nth-child(2):last-child)) {
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) !important;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body:has(> :nth-child(3))) {
  grid-template-columns: repeat(auto-fit, minmax(clamp(220px, 30vw, 360px), 1fr)) !important;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-body > *) {
  min-width: 0;
  min-height: calc(var(--tn-exec-editor-min-height) - 18px);
  height: 100%;
  align-self: stretch;
  overflow: hidden;
  border: 0;
  border-radius: 0;
  background: color-mix(in srgb, var(--bg-secondary) 42%, var(--bg-primary));
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-editor-panel) {
  min-height: calc(var(--tn-exec-editor-min-height) - 18px);
  display: grid;
  grid-template-rows: auto minmax(0, 1fr);
  gap: 2px;
  align-content: stretch;
  padding: 6px 8px 8px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :first-child) {
  min-height: 28px;
  display: flex;
  align-items: baseline;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :last-child) {
  min-height: 0;
  overflow: auto;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface) > :last-child) {
  background: color-mix(in srgb, var(--bg-elevated) calc(76% + (var(--tn-workspace-dominance) * 5%)), #000 calc(24% - (var(--tn-workspace-dominance) * 4%)));
  border: 1px solid color-mix(in srgb, var(--accent) calc(12% + (var(--tn-workspace-dominance) * 5%)), var(--border-default));
  border-radius: var(--tn-exec-radius-sm);
  box-shadow: inset 0 0 0 1px rgba(15, 23, 42, calc(0.06 + (var(--tn-workspace-dominance) * 0.012)));
  transition: border-color var(--tn-exec-motion-fast) var(--ease-standard), box-shadow var(--tn-exec-motion-fast) var(--ease-standard);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(.tool-editor-panel, .tool-local-surface):focus-within > :last-child) {
  border-color: color-mix(in srgb, var(--accent) 54%, var(--border-default));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.02), 0 0 0 2px color-mix(in srgb, var(--accent) 26%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])) {
  scrollbar-width: thin;
  scrollbar-color: color-mix(in srgb, var(--text-muted) 40%, transparent) transparent;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])::-webkit-scrollbar) {
  width: 9px;
  height: 9px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])::-webkit-scrollbar-thumb) {
  border-radius: var(--radius-pill);
  background: color-mix(in srgb, var(--text-muted) 38%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget :is(textarea, pre, [contenteditable="true"])::-webkit-scrollbar-track) {
  background: transparent;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-metrics),
:where(.runtime-metrics-row) {
  margin: 0;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--tn-exec-metrics-gap);
  font-size: var(--tn-exec-metrics-font-size);
  line-height: 1.15;
  padding: 1px 6px;
  border: 0;
  border-top: 1px solid color-mix(in srgb, var(--border-default) 24%, transparent);
  border-radius: 0;
  background: color-mix(in srgb, var(--bg-secondary) calc(48% - (var(--tn-shell-passive-mode) * 4%)), var(--bg-primary));
  min-height: 22px;
  max-height: 24px;
  opacity: 0.74;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions :is(label.tool-toggle, .tool-toggle)) {
  min-height: 28px;
  padding: 0 10px;
  border: 1px solid color-mix(in srgb, var(--border-default) 66%, transparent);
  border-radius: var(--radius-pill);
  background: color-mix(in srgb, var(--bg-elevated) 74%, var(--bg-primary));
  color: var(--text-secondary);
  font-size: var(--text-xs);
  font-weight: 600;
  line-height: 1;
  white-space: nowrap;
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions :is(label.tool-toggle, .tool-toggle) input[type="checkbox"]) {
  appearance: none;
  inline-size: 12px;
  block-size: 12px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--border-default) 80%, transparent);
  margin: 0 6px 0 0;
  background: color-mix(in srgb, var(--bg-secondary) 68%, transparent);
}

:where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions :is(label.tool-toggle, .tool-toggle) input[type="checkbox"]:checked) {
  background: var(--accent);
  border-color: color-mix(in srgb, var(--accent) 72%, white 28%);
}

:where(.tool-shell-page__docs, .tool-seo.tool-shell-page__docs) {
  max-width: 76ch;
}

:where(.tool-shell-page__docs .tool-md-section h2, .tool-shell-page__docs .tool-md-section h3) {
  margin-block: 0.45em 0.3em;
}

:where(.tool-shell-page__docs .tool-md-content p) {
  max-width: 68ch;
  margin-block: 0.4em 0.65em;
}

:where(.tool-shell-page__docs .tool-md-section) {
  opacity: 0.9;
}

/* Tool personality modifiers (micro-delta only, no layout ownership changes). */
:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-editor) {
  --tn-exec-editor-gap: 1px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-editor .tool-local-header) {
  letter-spacing: 0.01em;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-converter) {
  --tn-exec-editor-gap: 1px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-converter .tool-local-actions) {
  padding-top: 2px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-analyzer) {
  --tn-exec-editor-gap: 1px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-analyzer .tool-local-header) {
  font-weight: 600;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-utility) {
  --tn-exec-editor-gap: 1px;
}

:where([data-tool-content-host="true"] .tool-runtime-widget.execution-style-utility .tool-local-actions) {
  opacity: 0.95;
}

/* Universal execution button variants */
:where(.tool-btn--primary, .tn-exec-btn--primary) {
  border: var(--tn-exec-border-strong);
  border-radius: var(--tn-exec-radius-sm);
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 88%, white 12%), var(--accent));
  color: #fff;
  font-weight: 700;
}

:where(.tool-btn--secondary, .tn-exec-btn--secondary) {
  border: var(--tn-exec-border);
  border-radius: var(--tn-exec-radius-sm);
  background: color-mix(in srgb, var(--bg-elevated) 92%, var(--bg-primary));
  color: var(--text-primary);
  font-weight: 600;
}

:where(.tool-btn--ghost, .tn-exec-btn--ghost) {
  border: 1px solid transparent;
  border-radius: var(--tn-exec-radius-sm);
  background: transparent;
  color: var(--text-secondary);
}

:where(.tool-btn--primary, .tn-exec-btn--primary, .tool-btn--secondary, .tn-exec-btn--secondary, .tool-btn--ghost, .tn-exec-btn--ghost) {
  transition: transform 140ms var(--ease-standard), box-shadow 180ms var(--ease-standard), border-color 160ms var(--ease-standard), opacity 160ms var(--ease-standard), filter 140ms var(--ease-standard);
}

:where(.tool-btn--primary, .tn-exec-btn--primary):hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 10px 20px color-mix(in srgb, var(--accent) 26%, transparent);
}

:where(.tool-btn--primary, .tn-exec-btn--primary):active:not(:disabled) {
  transform: translateY(0) scale(0.98);
}

:where(.tool-btn--primary, .tn-exec-btn--primary, .tool-btn--secondary, .tn-exec-btn--secondary, .tool-btn--ghost, .tn-exec-btn--ghost):focus-visible {
  outline: 2px solid color-mix(in srgb, var(--accent) 85%, white 15%);
  outline-offset: 2px;
}

/* Toolbar hierarchy normalization when tools omit explicit button variants. */
:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):first-child:not(.tool-btn--secondary):not(.tool-btn--ghost)) {
  border: var(--tn-exec-border-strong);
  border-radius: var(--tn-exec-radius-sm);
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 88%, white 12%), var(--accent));
  color: #fff;
  font-weight: 700;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):is(:nth-child(2), :nth-child(3)):not(.tool-btn--primary):not(.tool-btn--ghost)) {
  border: var(--tn-exec-border);
  border-radius: var(--tn-exec-radius-sm);
  background: color-mix(in srgb, var(--bg-elevated) 92%, var(--bg-primary));
  color: var(--text-primary);
  font-weight: 600;
}

:where([data-tool-content-host="true"] .tool-runtime-widget > .tool-local-actions > :is(button, .tool-btn, [role="button"], a.tool-btn):nth-child(n + 4):not(.tool-btn--primary):not(.tool-btn--secondary)) {
  border: 1px solid transparent;
  border-radius: var(--tn-exec-radius-sm);
  background: transparent;
  color: var(--text-secondary);
}

@media (max-width: 920px) {
  :where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-actions) {
    flex-wrap: wrap;
    max-height: none;
  }

  :where([data-tool-content-host="true"] .tool-runtime-widget .tool-local-body) {
    grid-template-columns: minmax(0, 1fr);
    min-height: 0;
  }

  :where([data-tool-content-host="true"] .tool-runtime-widget .tool-editor-panel) {
    min-height: 220px;
  }
}
